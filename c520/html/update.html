<html><head><title>update.f</title></head><body><center>
<h2>CORSIKA Code version 5.20 mod / update.f</h2></center>
<i>Fortran project <a href="PROJECT_OVERVIEW.html">CORSIKA Code version 5.20 mod</a>,
     source module update.f</i>.<p>
<i>Source module last modified on Fri, 2 Jun 2000, 10:49;</i><br>
<i>HTML image of Fortran source automatically generated by <a href="http://www.e13.physik.tu-muenchen.de/Wuttke/f2h.html">
 for2html</a> on Fri, 2 Jun 2000, 12:11.</i>
<p><hr><p><code>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name="update" href="PROJECT_OVERVIEW.html#update">SUBROUTINE&nbsp;UPDATE</a>(&nbsp;HNEW,THCKHN,IPAS&nbsp;)<br>
&nbsp;<br>
#<i>-----------------------------------------------------------------------</i><br>
#<i>&nbsp;&nbsp;UPDATE(S&nbsp;PARTICLE&nbsp;PARAMETERS)</i><br>
#<i></i><br>
#<i>&nbsp;&nbsp;UPDATES&nbsp;PARTICLE&nbsp;PARAMETERS&nbsp;TO&nbsp;OBSERVATION&nbsp;LEVEL&nbsp;WITH&nbsp;NUMBER&nbsp;IPAS</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;TO&nbsp;POINT&nbsp;OF&nbsp;INTERACTION&nbsp;OR&nbsp;DECAY&nbsp;(IPAS=0)</i><br>
#<i>&nbsp;&nbsp;FOR&nbsp;CHARGED&nbsp;PARTICLES&nbsp;THE&nbsp;ENERGY&nbsp;LOSS&nbsp;IS&nbsp;COMPUTED&nbsp;FOR&nbsp;THE&nbsp;WHOLE&nbsp;STEP,</i><br>
#<i>&nbsp;&nbsp;SUBDIVIDED&nbsp;BY&nbsp;THE&nbsp;BOUNDARIES&nbsp;OF&nbsp;THE&nbsp;ATMOSPHERIC&nbsp;LAYERS.</i><br>
#<i>&nbsp;&nbsp;THE&nbsp;PARTICLE&nbsp;IS&nbsp;FLYING&nbsp;THE&nbsp;1ST&nbsp;HALF&nbsp;(DH/2)&nbsp;WITH&nbsp;INITIAL&nbsp;ENERGY</i><br>
#<i>&nbsp;&nbsp;AND&nbsp;ANGLE&nbsp;AND&nbsp;THE&nbsp;2ND&nbsp;HALF&nbsp;WITH&nbsp;FINAL&nbsp;ENERGY&nbsp;AND&nbsp;ANGLE.</i><br>
#<i>&nbsp;&nbsp;THE&nbsp;TIME&nbsp;CALCULATION&nbsp;FOLLOWS&nbsp;THIS&nbsp;SIMPLIFICATION.</i><br>
#<i>&nbsp;&nbsp;CHARGED&nbsp;PARTICLES&nbsp;ARE&nbsp;DEFLECTED&nbsp;IN&nbsp;THE&nbsp;EARTH&nbsp;MAGNETIC&nbsp;FIELD.</i><br>
#<i>&nbsp;&nbsp;THE&nbsp;ANGLE&nbsp;OF&nbsp;DEFLECTION&nbsp;BY&nbsp;MULTIPLE&nbsp;SCATTERING&nbsp;IS&nbsp;COMPUTED&nbsp;ONLY</i><br>
#<i>&nbsp;&nbsp;FOR&nbsp;MUONS&nbsp;AND&nbsp;ONLY&nbsp;ONCE&nbsp;FOR&nbsp;THE&nbsp;WHOLE&nbsp;STEP.</i><br>
#<i>&nbsp;&nbsp;IF&nbsp;PARTICLES&nbsp;COME&nbsp;TO&nbsp;REST&nbsp;BY&nbsp;STOPPING,&nbsp;THEIR&nbsp;PATH&nbsp;TO&nbsp;THE&nbsp;STOPPING</i><br>
#<i>&nbsp;&nbsp;POINT&nbsp;IS&nbsp;CALCULATED.</i><br>
#<i>&nbsp;&nbsp;CERENKOV&nbsp;RADIATION&nbsp;IS&nbsp;CALCULATED&nbsp;ONLY&nbsp;FOR&nbsp;LOWEST&nbsp;OBSERVATION&nbsp;LEVEL</i><br>
#<i>&nbsp;&nbsp;THIS&nbsp;SUBROUTINE&nbsp;IS&nbsp;CALLED&nbsp;FROM&nbsp;MAIN,&nbsp;BOX3,&nbsp;AND&nbsp;MUTRAC</i><br>
#<i>&nbsp;&nbsp;ARGUMENTS:</i><br>
#<i>&nbsp;&nbsp;&nbsp;HNEW&nbsp;&nbsp;&nbsp;=&nbsp;ALTITUDE&nbsp;OF&nbsp;PARTICLE&nbsp;AFTER&nbsp;UPDATE</i><br>
#<i>&nbsp;&nbsp;&nbsp;THCKHN&nbsp;=&nbsp;THICKNESS&nbsp;OF&nbsp;HNEW</i><br>
#<i>&nbsp;&nbsp;&nbsp;IPAS&nbsp;&nbsp;&nbsp;=&nbsp;0&nbsp;&nbsp;TRANSPORT&nbsp;TO&nbsp;END&nbsp;OF&nbsp;RANGE&nbsp;OF&nbsp;PARTICLE</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.NE.&nbsp;0&nbsp;&nbsp;TRANSPORT&nbsp;TO&nbsp;PASSAGE&nbsp;OF&nbsp;OBSERVATION&nbsp;LEVEL&nbsp;IPAS</i><br>
#<i></i><br>
#<i>&nbsp;&nbsp;REDESIGN:&nbsp;D.&nbsp;HECK&nbsp;&nbsp;&nbsp;&nbsp;IK3&nbsp;&nbsp;FZK&nbsp;KARLSRUHE</i><br>
#<i>-----------------------------------------------------------------------</i><br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPLICIT&nbsp;NONE<br>
#<i>KEEP,ATMOS2.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/ATMOS2/&nbsp;&nbsp;HLAY,THICKL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;HLAY(5),THICKL(5)<br>
#<i>KEEP,CONST.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/CONST/&nbsp;&nbsp;&nbsp;PI,PI2,OB3,TB3,ENEPER<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;PI,PI2,OB3,TB3,ENEPER<br>
#<i>KEEP,ELABCT.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/ELABCT/&nbsp;&nbsp;ELCUT<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;ELCUT(4)<br>
#<i>KEEP,GENER.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/GENER/&nbsp;&nbsp;&nbsp;GEN,ALEVEL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;GEN,ALEVEL<br>
#<i>KEEP,IRET.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/IRET/&nbsp;&nbsp;&nbsp;&nbsp;IRET1,IRET2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IRET1,IRET2<br>
#<i>KEEP,MAGNET.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/MAGNET/&nbsp;&nbsp;BX,BZ,BVAL,BNORMC,BNORM,COSB,SINB,BLIMIT<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;BX,BZ,BVAL,BNORMC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BNORM,COSB,SINB,BLIMIT<br>
#<i>KEEP,MUMULT.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/MUMULT/&nbsp;&nbsp;CHC,OMC,FMOLI<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;CHC,OMC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGICAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FMOLI<br>
#<i>KEEP,OBSPAR.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/OBSPAR/&nbsp;&nbsp;OBSLEV,THCKOB,XOFF,YOFF,THETAP,PHIP,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THETPR,PHIPR,NOBSLV<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;OBSLEV(10),THCKOB(10),XOFF(10),YOFF(10),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THETAP,THETPR(2),PHIP,PHIPR(2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOBSLV<br>
#<i>KEEP,PAM.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/PAM/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAMA,SIGNUM<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;PAMA(6000),SIGNUM(6000)<br>
#<i>KEEP,PARPAR.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/PARPAR/&nbsp;&nbsp;CURPAR,SECPAR,PRMPAR,OUTPAR,C,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E00,E00PN,PTOT0,PTOT0N,THICKH,ITYPE,LEVL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;CURPAR(14),SECPAR(14),PRMPAR(14),OUTPAR(14),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C(50),E00,E00PN,PTOT0,PTOT0N,THICKH<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ITYPE,LEVL<br>
#<i>KEEP,PARPAE.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;GAMMA,COSTHE,PHI,H,T,X,Y,CHI,BETA,GCM,ECM<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EQUIVALENCE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CURPAR(2),GAMMA),&nbsp;&nbsp;(CURPAR(3),COSTHE),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CURPAR(4),&nbsp;PHI&nbsp;),&nbsp;&nbsp;(CURPAR(5),&nbsp;H&nbsp;&nbsp;&nbsp;&nbsp;),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CURPAR(6),&nbsp;T&nbsp;&nbsp;&nbsp;),&nbsp;&nbsp;(CURPAR(7),&nbsp;X&nbsp;&nbsp;&nbsp;&nbsp;),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CURPAR(8),&nbsp;Y&nbsp;&nbsp;&nbsp;),&nbsp;&nbsp;(CURPAR(9),&nbsp;CHI&nbsp;&nbsp;),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CURPAR(10),BETA),&nbsp;&nbsp;(CURPAR(11),GCM&nbsp;&nbsp;),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CURPAR(12),ECM&nbsp;)<br>
#<i>KEEP,RANDPA.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/RANDPA/&nbsp;&nbsp;FAC,U1,U2,RD,NSEQ,ISEED,KNOR<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;FAC,U1,U2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RD(3000)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ISEED(103,10),NSEQ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGICAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KNOR<br>
#<i>KEEP,RUNPAR.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/RUNPAR/&nbsp;&nbsp;FIXHEI,THICK0,HILOECM,HILOELB,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STEPFC,NRRUN,NSHOW,PATAPE,MONIIN,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MONIOU,MDEBUG,NUCNUC,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CETAPE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHOWNO,ISHW,NOPART,NRECS,NBLKS,MAXPRT,NDEBDL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N1STTR,MDBASE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBDEL,DEBUG,FDECAY,FEGS,FIRSTI,FIXINC,FIXTAR,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIX1I,FMUADD,FNKG,FPRINT,FDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,GHEISH,GHESIG<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/RUNPAC/&nbsp;&nbsp;DSN,HOST,USER<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;FIXHEI,THICK0,HILOECM,HILOELB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STEPFC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NRRUN,NSHOW,PATAPE,MONIIN,MONIOU,MDEBUG,NUCNUC,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHOWNO,ISHW,NOPART,NRECS,NBLKS,MAXPRT,NDEBDL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N1STTR,MDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CETAPE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARACTER*79&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DSN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARACTER*20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOST,USER<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGICAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBDEL,DEBUG,FDECAY,FEGS,FIRSTI,FIXINC,FIXTAR,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIX1I,FMUADD,FNKG,FPRINT,FDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,GHEISH,GHESIG<br>
#<i>KEEP,CERHDR.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON/CERHDR/&nbsp;&nbsp;&nbsp;TPART,UPART,VPART,WPART,XPART,YPART,ZPART<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;TPART,UPART,VPART,WPART,XPART,YPART,ZPART<br>
#<i>KEND.</i><br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;ALPHA1,ALPHA2,BETAN,DENS,DH,DR,DTHICK,ELOSS,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FNORM1,FNORM2,F1COS1,F1COS2,F1SIN1,F1SIN2,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAMMAN,GAMSQ,GLCUT,GMSQM1,GAM0,HMIDDL,HNEW,OMEGA,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHISCT,PHI1,RADINV,<a href="rannor.html#rannor">RANNOR</a>,<a href="rhof.html#rhof">RHOF</a>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SINTH1,SINTH2,SN,SN1,SN2,SN3,SN4,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THCKHN,TH0,U10,U12,U20,U22,V,VSCAT,VVV,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V10,V12,V20,V22,W10,W12,W20,W22<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I,IL,ILAY,IPAS<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGICAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MUS<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SAVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VSCAT,PHISCT<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTERNAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="rannor.html#rannor">RANNOR</a>,<a href="rhof.html#rhof">RHOF</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;CHIT,DT,GAMK,<a href="heigh.html#heigh">HEIGH</a>,HNEWC,RATIO,THCKHC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICRNKV<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGICAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TFLAG<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTERNAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="heigh.html#heigh">HEIGH</a><br>
#<i>-----------------------------------------------------------------------</i><br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(DEBUG)&nbsp;WRITE(MDEBUG,457)&nbsp;(CURPAR(I),I=1,9),HNEW<br>
&nbsp;&nbsp;457&nbsp;FORMAT('<i>&nbsp;UPDATE:&nbsp;CURPAR=</i>',1P,9E10.3/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;HEIGHT&nbsp;</i>',0P,F11.1)<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IRET2&nbsp;&nbsp;=&nbsp;1<br>
#<i>&nbsp;&nbsp;TOTAL&nbsp;HEIGHT&nbsp;DIFFERENCE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;MAX(&nbsp;H&nbsp;-&nbsp;HNEW,&nbsp;1.D-10&nbsp;)<br>
#<i>&nbsp;&nbsp;ATMOSPHERE&nbsp;THICKNESS&nbsp;TRAVERSED</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DTHICK&nbsp;=&nbsp;(THCKHN&nbsp;-&nbsp;THICKH)&nbsp;/&nbsp;COSTHE<br>
#<i>&nbsp;&nbsp;TOTAL&nbsp;PATH&nbsp;FOR&nbsp;UNDEFLECTED&nbsp;PARTICLE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;DH&nbsp;/&nbsp;COSTHE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SN1&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0.25D0&nbsp;*&nbsp;SN<br>
&nbsp;<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;CALCULATE&nbsp;KINETIC&nbsp;ENERGY&nbsp;CUT</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;ITYPE&nbsp;.EQ.&nbsp;5&nbsp;.OR.&nbsp;ITYPE&nbsp;.EQ.&nbsp;6&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MUS&nbsp;&nbsp;&nbsp;=&nbsp;.TRUE.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GLCUT&nbsp;=&nbsp;ELCUT(2)&nbsp;/&nbsp;PAMA(ITYPE)&nbsp;+&nbsp;1.D0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MUS&nbsp;&nbsp;&nbsp;=&nbsp;.FALSE.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GLCUT&nbsp;=&nbsp;ELCUT(1)&nbsp;/&nbsp;PAMA(ITYPE)&nbsp;+&nbsp;1.D0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;CALCULATE&nbsp;THE&nbsp;ENERGY&nbsp;LOSS&nbsp;FOR&nbsp;CHARGED&nbsp;PARTICLES</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;SIGNUM(ITYPE)&nbsp;.NE.&nbsp;0.D0&nbsp;)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;LOOK&nbsp;WITHIN&nbsp;WHICH&nbsp;LAYER&nbsp;THE&nbsp;PARTICLE&nbsp;STARTS</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;H&nbsp;.LE.&nbsp;HLAY(2)&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ILAY&nbsp;=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TH0&nbsp;&nbsp;=&nbsp;THICKH<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;(&nbsp;H&nbsp;.LE.&nbsp;HLAY(3)&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ILAY&nbsp;=&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TH0&nbsp;&nbsp;=&nbsp;THICKH<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;(&nbsp;H&nbsp;.LE.&nbsp;HLAY(4)&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ILAY&nbsp;=&nbsp;3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TH0&nbsp;&nbsp;=&nbsp;THICKH<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ILAY&nbsp;=&nbsp;4<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TH0&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;MAX(&nbsp;THICKH,&nbsp;2.D-4&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
#<i>&nbsp;&nbsp;SET&nbsp;START&nbsp;VALUES&nbsp;FOR&nbsp;ITERATION</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAM0&nbsp;&nbsp;&nbsp;=&nbsp;GAMMA<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ILAY<br>
&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAM0&nbsp;&nbsp;&nbsp;=&nbsp;MAX(&nbsp;GAM0,&nbsp;1.0001D0&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAMSQ&nbsp;&nbsp;=&nbsp;GAM0**2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GMSQM1&nbsp;=&nbsp;GAMSQ&nbsp;-&nbsp;1.D0<br>
#<i>&nbsp;&nbsp;ENERGY&nbsp;LOSS&nbsp;BY&nbsp;IONIZATION</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELOSS&nbsp;&nbsp;=&nbsp;SIGNUM(ITYPE)**2&nbsp;*&nbsp;C(22)&nbsp;*<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;GAMSQ&nbsp;*&nbsp;(LOG(GMSQM1)&nbsp;+&nbsp;C(23))&nbsp;/&nbsp;GMSQM1&nbsp;-&nbsp;1.D0&nbsp;)<br>
#<i>&nbsp;&nbsp;LOOK&nbsp;WETHER&nbsp;PARTICLE&nbsp;PENETRATES&nbsp;LAYER&nbsp;BOUNDARY</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;THICKL(IL)&nbsp;.LT.&nbsp;THCKHN&nbsp;&nbsp;.AND.&nbsp;&nbsp;IL&nbsp;.GT.&nbsp;1&nbsp;)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;CALCULATE&nbsp;NEW&nbsp;START&nbsp;VALUES&nbsp;AT&nbsp;LAYER&nbsp;BOUNDARY</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAM0&nbsp;=&nbsp;GAM0&nbsp;-&nbsp;ELOSS&nbsp;*&nbsp;(THICKL(IL)&nbsp;-&nbsp;TH0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;(PAMA(ITYPE)*COSTHE)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;GAM0&nbsp;.LE.&nbsp;1.D0&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAMMAN&nbsp;=&nbsp;1.0001D0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GOTO&nbsp;3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TH0&nbsp;&nbsp;=&nbsp;THICKL(IL)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IL&nbsp;&nbsp;&nbsp;=&nbsp;IL&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GOTO&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
#<i>&nbsp;&nbsp;GAMMA&nbsp;VALUE&nbsp;FOR&nbsp;CHARGED&nbsp;PARTICLES&nbsp;AT&nbsp;END&nbsp;OF&nbsp;STEP</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAMMAN&nbsp;=&nbsp;GAM0&nbsp;-&nbsp;ELOSS&nbsp;*&nbsp;(THCKHN-TH0)&nbsp;/&nbsp;(PAMA(ITYPE)*COSTHE)<br>
&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
#<i>&nbsp;&nbsp;NO&nbsp;LOSS&nbsp;FOR&nbsp;NEUTRAL&nbsp;PARTICLES</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAMMAN&nbsp;=&nbsp;GAMMA<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;PARTICLE&nbsp;HAS&nbsp;TO&nbsp;BE&nbsp;TRACKED&nbsp;TO&nbsp;THE&nbsp;CUTOFF&nbsp;ENERGY&nbsp;FOR&nbsp;CERENKOV&nbsp;PHOTONS</i><br>
#<i>&nbsp;&nbsp;(AS&nbsp;NEUTRAL&nbsp;DO&nbsp;NOT&nbsp;LOOSE&nbsp;ENERGY&nbsp;IN&nbsp;UPDATE,&nbsp;THIS&nbsp;CONDITION&nbsp;IS</i><br>
#<i>&nbsp;&nbsp;FULFILLED&nbsp;BY&nbsp;CHARGED&nbsp;PARTICLES&nbsp;ONLY)</i><br>
#<i>&nbsp;&nbsp;(AS&nbsp;CERENKOV&nbsp;RUNS&nbsp;NOT&nbsp;WITH&nbsp;HORIZONT,&nbsp;NO&nbsp;PROGRAMMING&nbsp;FOR&nbsp;HORIZONT)</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;GAMMAN&nbsp;.LT.&nbsp;GLCUT&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAMMAN&nbsp;=&nbsp;0.9D0&nbsp;+&nbsp;GLCUT&nbsp;*&nbsp;0.1D0<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;SET&nbsp;START&nbsp;VALUES&nbsp;FOR&nbsp;ITERATION</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ILAY<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHIT&nbsp;&nbsp;&nbsp;=&nbsp;0.D0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAM0&nbsp;&nbsp;&nbsp;=&nbsp;GAMMA<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TH0&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;MAX(&nbsp;THICKH,&nbsp;2.D-4&nbsp;)<br>
&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAM0&nbsp;&nbsp;&nbsp;=&nbsp;MAX(&nbsp;GAM0,&nbsp;1.0001D0&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAMSQ&nbsp;&nbsp;=&nbsp;GAM0**2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GMSQM1&nbsp;=&nbsp;GAMSQ&nbsp;-&nbsp;1.D0<br>
#<i>&nbsp;&nbsp;ENERGY&nbsp;LOSS&nbsp;BY&nbsp;IONIZATION</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELOSS&nbsp;&nbsp;=&nbsp;SIGNUM(ITYPE)**2&nbsp;*&nbsp;C(22)&nbsp;*<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;GAMSQ&nbsp;*&nbsp;(LOG(GMSQM1)&nbsp;+&nbsp;C(23))&nbsp;/&nbsp;GMSQM1&nbsp;-1.D0&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELOSS&nbsp;&nbsp;=&nbsp;&nbsp;ELOSS&nbsp;/&nbsp;(PAMA(ITYPE)&nbsp;*&nbsp;COSTHE)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAMK&nbsp;&nbsp;&nbsp;=&nbsp;GAM0&nbsp;-&nbsp;ELOSS&nbsp;*&nbsp;(THICKL(ILAY)&nbsp;-&nbsp;TH0)<br>
#<i>&nbsp;&nbsp;LOOK&nbsp;WETHER&nbsp;PARTICLE&nbsp;PENETRATES&nbsp;LAYER&nbsp;BOUNDARY</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(GAMMAN&nbsp;.LT.&nbsp;GAMK&nbsp;.AND.&nbsp;IL.&nbsp;GT.&nbsp;1&nbsp;)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;CALCULATE&nbsp;PORTION&nbsp;OF&nbsp;RANGE&nbsp;AND&nbsp;NEW&nbsp;START&nbsp;VALUES&nbsp;AT&nbsp;LAYER&nbsp;BOUNDARY</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHIT&nbsp;=&nbsp;CHIT&nbsp;+&nbsp;(THICKL(IL)&nbsp;-&nbsp;TH0)&nbsp;/&nbsp;COSTHE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAM0&nbsp;=&nbsp;GAMK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TH0&nbsp;&nbsp;=&nbsp;THICKL(IL)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IL&nbsp;&nbsp;&nbsp;=&nbsp;IL&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GOTO&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
#<i>&nbsp;&nbsp;PENETRATED&nbsp;MATTER&nbsp;THICKNESS</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHI&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;CHIT&nbsp;+&nbsp;(GAM0&nbsp;-&nbsp;GAMMAN)&nbsp;/&nbsp;(ELOSS*COSTHE)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;DEBUG&nbsp;)&nbsp;WRITE(MDEBUG,*)'<i>UPDATE:&nbsp;GAMMAN,CHI=</i>',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SNGL(GAMMAN),SNGL(CHI)<br>
#<i>&nbsp;&nbsp;CALCULATE&nbsp;CORRECTED&nbsp;PATH&nbsp;PARAMETERS</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THCKHC&nbsp;=&nbsp;THICKH&nbsp;+&nbsp;COSTHE&nbsp;*&nbsp;CHI<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HNEWC&nbsp;&nbsp;=&nbsp;<a href="heigh.html#heigh">HEIGH</a>(THCKHC)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SN&nbsp;/&nbsp;(C(25)&nbsp;*&nbsp;BETA&nbsp;*&nbsp;GAMMA)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RATIO&nbsp;&nbsp;=&nbsp;.5D0&nbsp;*&nbsp;(H-HNEWC)&nbsp;/&nbsp;DH<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;H&nbsp;-&nbsp;HNEWC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;DH&nbsp;/&nbsp;COSTHE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SN1&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0.25D0&nbsp;*&nbsp;SN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TFLAG&nbsp;&nbsp;=&nbsp;.TRUE.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TFLAG&nbsp;&nbsp;=&nbsp;.FALSE.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
#<i>-----------------------------------------------------------------------</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;IPAS&nbsp;.EQ.&nbsp;0&nbsp;)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;UPDATE&nbsp;TO&nbsp;THE&nbsp;END&nbsp;POINT&nbsp;OF&nbsp;THE&nbsp;TRACK</i><br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;MUS&nbsp;)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;COULOMB&nbsp;SCATTERING&nbsp;ANGLE&nbsp;(FOR&nbsp;MUONS&nbsp;ONLY)</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;FMOLI)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;TREAT&nbsp;MUON&nbsp;MULTIPLE&nbsp;SCATTERING&nbsp;BY&nbsp;MOLIERE&nbsp;THEORY&nbsp;(SEE&nbsp;GEANT)</i><br>
#<i>&nbsp;&nbsp;CALCULATE&nbsp;AVERAGE&nbsp;DENSITY&nbsp;AND&nbsp;NUMBER&nbsp;OF&nbsp;SCATTERING&nbsp;(OMEGA)</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DENS&nbsp;&nbsp;&nbsp;=&nbsp;CHI/DH&nbsp;*&nbsp;COSTHE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OMEGA&nbsp;&nbsp;=&nbsp;OMC&nbsp;*&nbsp;CHI&nbsp;/&nbsp;&nbsp;BETA**2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;OMEGA&nbsp;.LE.&nbsp;20.D0&nbsp;)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;FEW&nbsp;SCATTERING&nbsp;EVENTS,&nbsp;APPLY&nbsp;PLURAL&nbsp;COULOMB&nbsp;SCATTERING</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;<a href="mucoul.html#mucoul">MUCOUL</a>(OMEGA,DENS,VSCAT)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
#<i>&nbsp;&nbsp;ENOUGH&nbsp;SCATTERING&nbsp;EVENTS,&nbsp;APPLY&nbsp;MOLIERE'S&nbsp;THEORY</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;<a href="mmolie.html#mmolie">MMOLIE</a>(OMEGA,DENS,VSCAT)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
#<i>&nbsp;&nbsp;TREAT&nbsp;MUON&nbsp;MULTIPLE&nbsp;SCATTERING&nbsp;BY&nbsp;GAUSS&nbsp;DISTRIBUTION</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VSCAT&nbsp;=&nbsp;<a href="rannor.html#rannor">RANNOR</a>(&nbsp;0.D0,&nbsp;C(30)&nbsp;*&nbsp;SQRT(&nbsp;CHI/C(21)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;(PAMA(5)&nbsp;*&nbsp;GAMMA&nbsp;*&nbsp;BETA**2)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;=&nbsp;VSCAT<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;<a href="rmmar.html#rmmar">RMMAR</a>(&nbsp;RD,1,1&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHISCT&nbsp;=&nbsp;RD(1)&nbsp;*&nbsp;PI2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF(DEBUG)WRITE(MDEBUG,*)'<i>UPDATE:&nbsp;VSCAT=</i>',SNGL(VSCAT),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'<i>&nbsp;PHISCT=</i>',SNGL(PHISCT)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;CERENKOV&nbsp;RADIATION:&nbsp;LOOK,&nbsp;WHETHER&nbsp;PATH&nbsp;ENDS&nbsp;ABOVE&nbsp;LOWEST&nbsp;OBSERV.LEVEL</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;TFLAG&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HNEW&nbsp;&nbsp;&nbsp;=&nbsp;HNEWC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THCKHN&nbsp;=&nbsp;THCKHC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(DEBUG)&nbsp;WRITE(MDEBUG,*)'<i>UPDATE:&nbsp;CHANGED&nbsp;HNEW&nbsp;=</i>',SNGL(HNEW)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;HNEW&nbsp;.GT.&nbsp;OBSLEV(NOBSLV)&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICRNKV&nbsp;=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICRNKV&nbsp;=&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;UPDATE&nbsp;TO&nbsp;THE&nbsp;OBSERVATION&nbsp;LEVELS</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;MUS&nbsp;)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;COULOMB&nbsp;SCATTERING&nbsp;ANGLE&nbsp;(FOR&nbsp;MUONS&nbsp;ONLY)</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;=&nbsp;VSCAT&nbsp;*&nbsp;SQRT(&nbsp;DTHICK&nbsp;/&nbsp;CHI&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;CERENKOV&nbsp;RADIATION:&nbsp;LOOK,&nbsp;WHETHER&nbsp;LOWEST&nbsp;OBSERVATION&nbsp;LEVEL</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;IPAS&nbsp;.EQ.&nbsp;NOBSLV&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICRNKV&nbsp;=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICRNKV&nbsp;=&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;REJECT&nbsp;ALL&nbsp;PARTICLES&nbsp;IF&nbsp;BELOW&nbsp;KINETIC&nbsp;ENERGY&nbsp;CUT</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;GAMMAN&nbsp;.LT.&nbsp;GLCUT&nbsp;.AND.&nbsp;ICRNKV&nbsp;.EQ.&nbsp;0&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(DEBUG)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;WRITE(MDEBUG,*)&nbsp;'<i>UPDATE:&nbsp;PARTICLE&nbsp;</i>',ITYPE,'<i>&nbsp;BELOW&nbsp;ENERGY&nbsp;CUT</i>'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,'<i>&nbsp;CERENKOV&nbsp;LIGHT&nbsp;NOT&nbsp;CALCULATED</i>'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
#<i>-----------------------------------------------------------------------</i><br>
#<i>&nbsp;&nbsp;CHARGED&nbsp;PARTICLES&nbsp;SUFFER&nbsp;IONIZATION&nbsp;LOSS,&nbsp;DEFLECTION&nbsp;IN&nbsp;MAGNETIC</i><br>
#<i>&nbsp;&nbsp;FIELD&nbsp;AND&nbsp;MUONS&nbsp;IN&nbsp;ADDITION&nbsp;DO&nbsp;MULTIPLE&nbsp;COULOMB&nbsp;SCATTERING</i><br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;SIGNUM(ITYPE)&nbsp;.NE.&nbsp;0.D0&nbsp;)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;DEFLECTION&nbsp;IN&nbsp;EARTH&nbsp;MAGNETIC&nbsp;FIELD&nbsp;ON&nbsp;FIRST&nbsp;HALF&nbsp;OF&nbsp;STEP</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALPHA1&nbsp;=&nbsp;SIGNUM(ITYPE)&nbsp;*<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MIN(&nbsp;1.D0,&nbsp;2.D0*SN1*BNORMC&nbsp;/(PAMA(ITYPE)*BETA*GAMMA)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SINTH1&nbsp;=&nbsp;SQRT(&nbsp;1.D0&nbsp;-&nbsp;COSTHE**2&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U10&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SINTH1&nbsp;*&nbsp;COS(-PHI)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V10&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SINTH1&nbsp;*&nbsp;SIN(-PHI)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;W10&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;COSTHE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FNORM1&nbsp;=&nbsp;1.D0&nbsp;-&nbsp;0.5D0*ALPHA1**2&nbsp;*&nbsp;(1.D0&nbsp;-&nbsp;0.75D0*ALPHA1**2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F1COS1&nbsp;=&nbsp;(&nbsp;1.D0&nbsp;-&nbsp;FNORM1&nbsp;)&nbsp;*&nbsp;COSB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F1SIN1&nbsp;=&nbsp;(&nbsp;1.D0&nbsp;-&nbsp;FNORM1&nbsp;)&nbsp;*&nbsp;SINB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VVV&nbsp;=&nbsp;V10&nbsp;*&nbsp;ALPHA1&nbsp;*&nbsp;FNORM1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U12&nbsp;=&nbsp;U10&nbsp;*&nbsp;(1.D0&nbsp;-&nbsp;F1SIN1*SINB)&nbsp;+&nbsp;W10*F1SIN1*COSB&nbsp;+&nbsp;VVV*SINB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V12&nbsp;=&nbsp;FNORM1&nbsp;*&nbsp;(&nbsp;V10&nbsp;-&nbsp;ALPHA1&nbsp;*&nbsp;(U10&nbsp;*&nbsp;SINB&nbsp;-&nbsp;W10&nbsp;*&nbsp;COSB)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;W12&nbsp;=&nbsp;W10&nbsp;*&nbsp;(1.D0&nbsp;-&nbsp;F1COS1*COSB)&nbsp;+&nbsp;U10*F1COS1*SINB&nbsp;-&nbsp;VVV*COSB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RADINV&nbsp;=&nbsp;1.5D0&nbsp;-&nbsp;0.5D0&nbsp;*&nbsp;(&nbsp;U12**2&nbsp;+&nbsp;V12**2&nbsp;+&nbsp;W12**2&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;W12&nbsp;=&nbsp;MIN(&nbsp;1.D0,&nbsp;RADINV&nbsp;*&nbsp;W12&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;W12&nbsp;.LE.&nbsp;C(29)&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(DEBUG)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;WRITE(MDEBUG,*)&nbsp;'<i>UPDATE:&nbsp;PARTICLE&nbsp;</i>',ITYPE,'<i>&nbsp;BELOW&nbsp;ANGLE&nbsp;CUT&nbsp;1</i>'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SN2&nbsp;=&nbsp;0.25D0&nbsp;*&nbsp;DH&nbsp;/&nbsp;W12<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U12&nbsp;=&nbsp;RADINV&nbsp;*&nbsp;U12<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V12&nbsp;=&nbsp;RADINV&nbsp;*&nbsp;V12<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;U12**2&nbsp;+&nbsp;V12**2&nbsp;.GT.&nbsp;3.D-38&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHI1&nbsp;=&nbsp;-ATAN2(&nbsp;V12,&nbsp;U12&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHI1&nbsp;=&nbsp;0.D0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
#<i>&nbsp;&nbsp;CERENKOV&nbsp;RADIATION:&nbsp;FILL&nbsp;PARTICLE&nbsp;COORDINATES&nbsp;INTO&nbsp;COMMON&nbsp;CERHDR</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;ICRNKV&nbsp;.EQ.&nbsp;1&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XPART&nbsp;=&nbsp;X&nbsp;+&nbsp;SN1&nbsp;*&nbsp;U10&nbsp;+&nbsp;SN2&nbsp;*&nbsp;U12<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YPART&nbsp;=&nbsp;Y&nbsp;-&nbsp;SN1&nbsp;*&nbsp;V10&nbsp;-&nbsp;SN2&nbsp;*&nbsp;V12<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TPART&nbsp;=&nbsp;T&nbsp;+&nbsp;(&nbsp;SN1&nbsp;+&nbsp;SN2&nbsp;)&nbsp;/&nbsp;(&nbsp;C(25)&nbsp;*&nbsp;BETA&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZPART&nbsp;=&nbsp;H&nbsp;-&nbsp;DH&nbsp;*&nbsp;0.5D0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WPART&nbsp;=&nbsp;W12<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UPART&nbsp;=&nbsp;U12<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VPART&nbsp;=&nbsp;-V12<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;<a href="cerenkov.html#cerenh">CERENH</a>(&nbsp;SN1+SN2,&nbsp;BETA&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;CHANGE&nbsp;DIRECTION&nbsp;BY&nbsp;COULOMB&nbsp;SCATTERING&nbsp;(FOR&nbsp;MUONS&nbsp;ONLY)</i><br>
#<i>&nbsp;&nbsp;BEFORE&nbsp;SCATTERING&nbsp;:&nbsp;DIRECTION&nbsp;COSINES&nbsp;ARE&nbsp;U12,V12,W12</i><br>
#<i>&nbsp;&nbsp;AFTER&nbsp;&nbsp;SCATTERING&nbsp;:&nbsp;DIRECTION&nbsp;COSINES&nbsp;ARE&nbsp;U20,V20,W20</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;MUS&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;<a href="addang.html#addang">ADDANG</a>(&nbsp;W12,PHI1,&nbsp;COS(V),PHISCT,&nbsp;W20,PHI1&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;W20&nbsp;.LT.&nbsp;C(29)&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(DEBUG)&nbsp;WRITE(MDEBUG,*)&nbsp;'<i>UPDATE:&nbsp;MUON&nbsp;BELOW&nbsp;ANGLE&nbsp;CUT</i>'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SINTH2&nbsp;=&nbsp;SQRT(&nbsp;1.D0&nbsp;-&nbsp;W20**2&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U20&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SINTH2&nbsp;*&nbsp;COS(&nbsp;-PHI1&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V20&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SINTH2&nbsp;*&nbsp;SIN(&nbsp;-PHI1&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U20&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;U12<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V20&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;V12<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;W20&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;W12<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;NEW&nbsp;PATH&nbsp;LENGTH,&nbsp;NEW&nbsp;BETA&nbsp;VALUE&nbsp;BECAUSE&nbsp;OF&nbsp;IONIZATION&nbsp;ENERGY&nbsp;LOSS</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SN3&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0.25D0&nbsp;*&nbsp;DH&nbsp;/&nbsp;W20<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BETAN&nbsp;&nbsp;=&nbsp;SQRT(&nbsp;GAMMAN**2&nbsp;-&nbsp;1.D0&nbsp;)&nbsp;/&nbsp;GAMMAN<br>
#<i>&nbsp;&nbsp;DEFLECTION&nbsp;IN&nbsp;EARTH&nbsp;MAGNETIC&nbsp;FIELD&nbsp;ON&nbsp;SECOND&nbsp;HALF&nbsp;OF&nbsp;STEP</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALPHA2&nbsp;=&nbsp;SIGNUM(ITYPE)&nbsp;*<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MIN(1.D0,2.D0*SN3*BNORMC&nbsp;/&nbsp;(PAMA(ITYPE)*BETAN*GAMMAN))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FNORM2&nbsp;=&nbsp;1.D0&nbsp;-&nbsp;0.5D0*ALPHA2**2&nbsp;*&nbsp;(1.D0&nbsp;-&nbsp;0.75D0*ALPHA2**2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F1SIN2&nbsp;=&nbsp;(&nbsp;1.D0&nbsp;-&nbsp;FNORM2&nbsp;)&nbsp;*&nbsp;SINB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F1COS2&nbsp;=&nbsp;(&nbsp;1.D0&nbsp;-&nbsp;FNORM2&nbsp;)&nbsp;*&nbsp;COSB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VVV&nbsp;=&nbsp;V20&nbsp;*&nbsp;ALPHA2&nbsp;*&nbsp;FNORM2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U22&nbsp;=&nbsp;U20*(1.D0&nbsp;-&nbsp;F1SIN2*SINB)&nbsp;+&nbsp;W20*F1SIN2*COSB&nbsp;+&nbsp;VVV*SINB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V22&nbsp;=&nbsp;FNORM2&nbsp;*&nbsp;(&nbsp;V20&nbsp;-&nbsp;ALPHA2&nbsp;*&nbsp;(U20&nbsp;*&nbsp;SINB&nbsp;-&nbsp;W20&nbsp;*&nbsp;COSB)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;W22&nbsp;=&nbsp;W20*(1.D0&nbsp;-&nbsp;F1COS2*COSB)&nbsp;+&nbsp;U20*F1COS2*SINB&nbsp;-&nbsp;VVV*COSB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RADINV&nbsp;=&nbsp;1.5D0&nbsp;-&nbsp;0.5D0&nbsp;*&nbsp;(&nbsp;U22**2&nbsp;+&nbsp;V22**2&nbsp;+&nbsp;W22**2&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;W22&nbsp;=&nbsp;MIN(&nbsp;1.D0,&nbsp;RADINV&nbsp;*&nbsp;W22&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;W22&nbsp;.LT.&nbsp;C(29)&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(DEBUG)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;WRITE(MDEBUG,*)&nbsp;'<i>UPDATE:&nbsp;PARTICLE&nbsp;</i>',ITYPE,'<i>&nbsp;BELOW&nbsp;ANGLE&nbsp;CUT&nbsp;2</i>'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SN4&nbsp;=&nbsp;0.25D0&nbsp;*&nbsp;DH&nbsp;/&nbsp;W22<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U22&nbsp;=&nbsp;RADINV&nbsp;*&nbsp;U22<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V22&nbsp;=&nbsp;RADINV&nbsp;*&nbsp;V22<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(3)&nbsp;=&nbsp;W22<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;U22**2&nbsp;+&nbsp;V22**2&nbsp;.GT.&nbsp;3.D-38&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(4)&nbsp;=&nbsp;-ATAN2(&nbsp;V22,&nbsp;U22&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(4)&nbsp;=&nbsp;0.D0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
#<i>&nbsp;&nbsp;UPDATE&nbsp;COORDINATES&nbsp;AND&nbsp;TIME&nbsp;TO&nbsp;THE&nbsp;END&nbsp;OF&nbsp;DISTANCE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;TFLAG&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(6)&nbsp;=&nbsp;T&nbsp;+&nbsp;DT*&nbsp;(&nbsp;RATIO*GAMMA&nbsp;+&nbsp;(1.D0-RATIO)*GAMMAN)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(6)&nbsp;=&nbsp;T&nbsp;+&nbsp;(SN1&nbsp;+&nbsp;SN2)/(BETA&nbsp;*C(25))&nbsp;+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(SN3&nbsp;+&nbsp;SN4)/(BETAN*C(25))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(7)&nbsp;=&nbsp;X&nbsp;+&nbsp;SN1*U10&nbsp;+&nbsp;SN2*U12&nbsp;+&nbsp;SN3*U20&nbsp;+&nbsp;SN4*U22<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(8)&nbsp;=&nbsp;Y&nbsp;-&nbsp;SN1*V10&nbsp;-&nbsp;SN2*V12&nbsp;-&nbsp;SN3*V20&nbsp;-&nbsp;SN4*V22<br>
#<i>&nbsp;&nbsp;CERENKOV&nbsp;RADIATION:&nbsp;FILL&nbsp;PARTICLE&nbsp;COORDINATES&nbsp;INTO&nbsp;COMMON&nbsp;CERHDR</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;ICRNKV&nbsp;.EQ.&nbsp;1&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XPART&nbsp;=&nbsp;OUTPAR(7)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YPART&nbsp;=&nbsp;OUTPAR(8)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZPART&nbsp;=&nbsp;HNEW<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TPART&nbsp;=&nbsp;OUTPAR(6)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WPART&nbsp;=&nbsp;W22<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UPART&nbsp;=&nbsp;U22<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VPART&nbsp;=&nbsp;-V22<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;<a href="cerenkov.html#cerenh">CERENH</a>(&nbsp;SN3+SN4,&nbsp;BETAN&nbsp;)<br>
#<i>&nbsp;&nbsp;REJECT&nbsp;PARTICLES&nbsp;AFTER&nbsp;PRODUCTION&nbsp;OF&nbsp;CERENKOV&nbsp;LIGHT</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;GAMMAN&nbsp;.LT.&nbsp;GLCUT&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(DEBUG)&nbsp;WRITE(MDEBUG,*)&nbsp;'<i>UPDATE:&nbsp;PARTICLE&nbsp;</i>',ITYPE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'<i>&nbsp;BELOW&nbsp;ENERGY&nbsp;CUT&nbsp;AFTER&nbsp;CREATION&nbsp;OF&nbsp;CERENKOV&nbsp;LIGHT</i>'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;<br>
#<i>-----------------------------------------------------------------------</i><br>
#<i>&nbsp;&nbsp;NEUTRAL&nbsp;PARTICLES</i><br>
#<i>&nbsp;&nbsp;NO&nbsp;COULOMB&nbsp;SCATTERING,&nbsp;NO&nbsp;DEFLECTION&nbsp;IN&nbsp;MAGNETIC&nbsp;FIELD</i><br>
&nbsp;<br>
#<i>&nbsp;&nbsp;HORIZONTAL&nbsp;PATH&nbsp;LENGTH</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SN&nbsp;*&nbsp;SQRT(&nbsp;1.D0&nbsp;-&nbsp;COSTHE**2&nbsp;)<br>
#<i>&nbsp;&nbsp;UPDATE&nbsp;COORDINATES&nbsp;AND&nbsp;TIME</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(3)&nbsp;=&nbsp;COSTHE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(4)&nbsp;=&nbsp;PHI<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(6)&nbsp;=&nbsp;T&nbsp;+&nbsp;SN&nbsp;/&nbsp;(&nbsp;C(25)&nbsp;*&nbsp;BETA&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(7)&nbsp;=&nbsp;X&nbsp;+&nbsp;DR&nbsp;*&nbsp;COS(PHI)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(8)&nbsp;=&nbsp;Y&nbsp;+&nbsp;DR&nbsp;*&nbsp;SIN(PHI)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
#<i>-----------------------------------------------------------------------</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(&nbsp;1)&nbsp;=&nbsp;CURPAR(1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(&nbsp;2)&nbsp;=&nbsp;GAMMAN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(&nbsp;5)&nbsp;=&nbsp;HNEW<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(&nbsp;9)&nbsp;=&nbsp;GEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPAR(10)&nbsp;=&nbsp;ALEVEL<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;REGULAR&nbsp;END&nbsp;OF&nbsp;UPDATE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IRET2&nbsp;=&nbsp;0<br>
&nbsp;<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(DEBUG)&nbsp;WRITE(MDEBUG,458)&nbsp;(OUTPAR(I),I=1,9)<br>
&nbsp;&nbsp;458&nbsp;FORMAT('<i>&nbsp;UPDATE:&nbsp;OUTPAR=</i>',1P,9E10.3)<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<br>
<p><hr><p></body></html>
