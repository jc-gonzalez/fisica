<html><head><title>addani.f</title></head><body><center>
<h2>CORSIKA Code version 5.20 mod / addani.f</h2></center>
<i>Fortran project <a href="PROJECT_OVERVIEW.html">CORSIKA Code version 5.20 mod</a>,
     source module addani.f</i>.<p>
<i>Source module last modified on Fri, 2 Jun 2000, 10:48;</i><br>
<i>HTML image of Fortran source automatically generated by <a href="http://www.e13.physik.tu-muenchen.de/Wuttke/f2h.html">
 for2html</a> on Fri, 2 Jun 2000, 12:11.</i>
<p><hr><p><code>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name="addani" href="PROJECT_OVERVIEW.html#addani">SUBROUTINE&nbsp;ADDANI</a>(&nbsp;COST0,PHI0,&nbsp;COST1,PHI1,&nbsp;DCTH,DPHI&nbsp;)<br>
&nbsp;<br>
#<i>-----------------------------------------------------------------------</i><br>
#<i>&nbsp;&nbsp;ADD(ITION&nbsp;OF)&nbsp;AN(GLES)&nbsp;I(NVERTED)</i><br>
#<i></i><br>
#<i>&nbsp;&nbsp;GIVEN&nbsp;TWO&nbsp;DIRECTIONS&nbsp;(0&nbsp;AND&nbsp;1)&nbsp;IN&nbsp;A&nbsp;COMMON&nbsp;SYSTEM&nbsp;OF&nbsp;REFERENCE.</i><br>
#<i>&nbsp;&nbsp;FIND&nbsp;DCTH&nbsp;AND&nbsp;DPHI&nbsp;SUCH,&nbsp;THAT&nbsp;THE&nbsp;ROUTINE&nbsp;ADDANG&nbsp;TRANSFORMS</i><br>
#<i>&nbsp;&nbsp;(COST0,PHI0)&nbsp;BY&nbsp;ADDING&nbsp;(DCTH,DPHI)&nbsp;INTO&nbsp;(COST1,PHI1).</i><br>
#<i>&nbsp;&nbsp;CALCULATION&nbsp;IS&nbsp;DONE&nbsp;BY&nbsp;SEQUENTIAL&nbsp;ROTATIONS&nbsp;:</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;ROTATE&nbsp;VECTOR&nbsp;AROUND&nbsp;Z&nbsp;AXIS&nbsp;BY&nbsp;-PHI1</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;ROTATE&nbsp;VECTOR&nbsp;AROUND&nbsp;Y&nbsp;AXIS&nbsp;BY&nbsp;-THETA1</i><br>
#<i>&nbsp;&nbsp;NOW&nbsp;VECTOR&nbsp;IS&nbsp;(X,Y,Z)&nbsp;WITH&nbsp;DCTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Z</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;TAN(DPHI)&nbsp;=&nbsp;Y/X</i><br>
#<i>&nbsp;&nbsp;THIS&nbsp;SUBROUTINE&nbsp;IS&nbsp;CALLED&nbsp;FROM&nbsp;MUDECY</i><br>
#<i>&nbsp;&nbsp;ARGUMENTS:</i><br>
#<i>&nbsp;&nbsp;&nbsp;COST0&nbsp;&nbsp;=&nbsp;COSINE&nbsp;THETA&nbsp;OF&nbsp;PARTICLE&nbsp;BEFORE</i><br>
#<i>&nbsp;&nbsp;&nbsp;PHI0&nbsp;&nbsp;&nbsp;=&nbsp;PHI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OF&nbsp;PARTICLE&nbsp;BEFORE</i><br>
#<i>&nbsp;&nbsp;&nbsp;COST1&nbsp;&nbsp;=&nbsp;COSINE&nbsp;THETA&nbsp;OF&nbsp;PARTICLE</i><br>
#<i>&nbsp;&nbsp;&nbsp;PHI1&nbsp;&nbsp;&nbsp;=&nbsp;PHI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OF&nbsp;PARTICLE</i><br>
#<i>&nbsp;&nbsp;&nbsp;DCTH&nbsp;&nbsp;&nbsp;=&nbsp;COSINE&nbsp;THETA&nbsp;OF&nbsp;ANGLE</i><br>
#<i>&nbsp;&nbsp;&nbsp;DPHI&nbsp;&nbsp;&nbsp;=&nbsp;PHI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OF&nbsp;ANGLE</i><br>
#<i>-----------------------------------------------------------------------</i><br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPLICIT&nbsp;NONE<br>
#<i>KEEP,CONST.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/CONST/&nbsp;&nbsp;&nbsp;PI,PI2,OB3,TB3,ENEPER<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;PI,PI2,OB3,TB3,ENEPER<br>
#<i>KEEP,RUNPAR.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/RUNPAR/&nbsp;&nbsp;FIXHEI,THICK0,HILOECM,HILOELB,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STEPFC,NRRUN,NSHOW,PATAPE,MONIIN,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MONIOU,MDEBUG,NUCNUC,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CETAPE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHOWNO,ISHW,NOPART,NRECS,NBLKS,MAXPRT,NDEBDL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N1STTR,MDBASE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBDEL,DEBUG,FDECAY,FEGS,FIRSTI,FIXINC,FIXTAR,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIX1I,FMUADD,FNKG,FPRINT,FDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,GHEISH,GHESIG<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/RUNPAC/&nbsp;&nbsp;DSN,HOST,USER<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;FIXHEI,THICK0,HILOECM,HILOELB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STEPFC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NRRUN,NSHOW,PATAPE,MONIIN,MONIOU,MDEBUG,NUCNUC,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHOWNO,ISHW,NOPART,NRECS,NBLKS,MAXPRT,NDEBDL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N1STTR,MDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CETAPE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARACTER*79&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DSN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARACTER*20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOST,USER<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGICAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBDEL,DEBUG,FDECAY,FEGS,FIRSTI,FIXINC,FIXTAR,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIX1I,FMUADD,FNKG,FPRINT,FDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,GHEISH,GHESIG<br>
#<i>KEND.</i><br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;COST0,COST1,CP,CP1,CT,CT1,DCTH,DPHI,PHI0,PHI1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SP,SP1,ST,ST1,X,XX,Y,YY,Z,ZZ<br>
#<i>-----------------------------------------------------------------------</i><br>
&nbsp;<br>
#<i>C&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;DEBUG&nbsp;)&nbsp;WRITE(MDEBUG,*)&nbsp;'ADDANI:'</i><br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CT&nbsp;&nbsp;=&nbsp;COST0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ST&nbsp;&nbsp;=&nbsp;SQRT(1.D0-CT**2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CP&nbsp;&nbsp;=&nbsp;COS(PHI0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SP&nbsp;&nbsp;=&nbsp;SIN(PHI0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CT1&nbsp;=&nbsp;COST1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ST1&nbsp;=&nbsp;SQRT(1.D0-CT1**2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CP1&nbsp;=&nbsp;COS(PHI1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SP1&nbsp;=&nbsp;SIN(PHI1)<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;=&nbsp;ST1&nbsp;*&nbsp;CP1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;=&nbsp;ST1&nbsp;*&nbsp;SP1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z&nbsp;=&nbsp;CT1<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XX&nbsp;=&nbsp;&nbsp;CT*CP*X&nbsp;+&nbsp;CT*SP*Y&nbsp;-&nbsp;ST*Z<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YY&nbsp;=&nbsp;-SP&nbsp;&nbsp;&nbsp;*X&nbsp;+&nbsp;CP&nbsp;&nbsp;&nbsp;*Y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZZ&nbsp;=&nbsp;&nbsp;ST*CP*X&nbsp;+&nbsp;ST*SP*Y&nbsp;+&nbsp;CT*Z<br>
&nbsp;<br>
#<i>&nbsp;&nbsp;GET&nbsp;NEW&nbsp;COSINE(THETA)&nbsp;AND&nbsp;PHI</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DCTH&nbsp;&nbsp;&nbsp;=&nbsp;ZZ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;YY&nbsp;.NE.&nbsp;0.D0&nbsp;&nbsp;.OR.&nbsp;&nbsp;XX&nbsp;.NE.&nbsp;0.D0&nbsp;)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPHI&nbsp;=&nbsp;ATAN2(&nbsp;YY,&nbsp;XX&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPHI&nbsp;=&nbsp;0.D0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<br>
<p><hr><p></body></html>
