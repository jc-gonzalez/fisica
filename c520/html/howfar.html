<html><head><title>howfar.f</title></head><body><center>
<h2>CORSIKA Code version 5.20 mod / howfar.f</h2></center>
<i>Fortran project <a href="PROJECT_OVERVIEW.html">CORSIKA Code version 5.20 mod</a>,
     source module howfar.f</i>.<p>
<i>Source module last modified on Fri, 2 Jun 2000, 10:49;</i><br>
<i>HTML image of Fortran source automatically generated by <a href="http://www.e13.physik.tu-muenchen.de/Wuttke/f2h.html">
 for2html</a> on Fri, 2 Jun 2000, 12:11.</i>
<p><hr><p><code>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name="howfar" href="PROJECT_OVERVIEW.html#howfar">SUBROUTINE&nbsp;HOWFAR</a><br>
#<i></i><br>
#<i>*********************************************************************</i><br>
#<i>&nbsp;&nbsp;DESIGN&nbsp;&nbsp;:&nbsp;D.&nbsp;HECK&nbsp;&nbsp;&nbsp;IK3&nbsp;&nbsp;FZK&nbsp;KARLSRUHE</i><br>
#<i>&nbsp;&nbsp;DATE&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;SEP&nbsp;&nbsp;05,&nbsp;1988</i><br>
#<i>*********************************************************************</i><br>
#<i>&nbsp;&nbsp;THE&nbsp;FOLLOWING&nbsp;IS&nbsp;A&nbsp;GENERAL&nbsp;SPECIFICATION&nbsp;OF&nbsp;HOWFAR:</i><br>
#<i>&nbsp;&nbsp;GIVEN&nbsp;A&nbsp;PARTICLE&nbsp;AT&nbsp;(X,Y,Z)&nbsp;IN&nbsp;REGION&nbsp;IR&nbsp;AND&nbsp;GOING&nbsp;IN&nbsp;DIRECTION</i><br>
#<i>&nbsp;&nbsp;(U,V,W),&nbsp;THIS&nbsp;ROUTINE&nbsp;ANSWERS&nbsp;THE&nbsp;QUESTION,&nbsp;CAN&nbsp;THE&nbsp;PARTICLE&nbsp;GO</i><br>
#<i>&nbsp;&nbsp;A&nbsp;DISTANCE&nbsp;USTEP&nbsp;WITHOUT&nbsp;CROSSING&nbsp;A&nbsp;BOUNDARY&nbsp;OR&nbsp;OBSERVATION&nbsp;LEVEL?</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;YES,&nbsp;IT&nbsp;CALCULATES&nbsp;DNEAR&nbsp;AND&nbsp;RETURNS.</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NO,&nbsp;IT&nbsp;SETS&nbsp;USTEP=DISTANCE&nbsp;TO&nbsp;BOUNDARY&nbsp;OR&nbsp;DETECTOR&nbsp;IN</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;THE&nbsp;CURRENT&nbsp;DIRECTION.</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT&nbsp;SETS&nbsp;IRNEW&nbsp;TO&nbsp;THE&nbsp;REGION&nbsp;NUMBER&nbsp;ON&nbsp;THE&nbsp;FAR&nbsp;SIDE</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OF&nbsp;THE&nbsp;BOUNDARY&nbsp;(THIS&nbsp;CAN&nbsp;BE&nbsp;MESSY&nbsp;IN&nbsp;GENERAL!);</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT&nbsp;SETS&nbsp;NEWOBS&nbsp;TO&nbsp;THE&nbsp;DETECTOR&nbsp;NUMBER&nbsp;NEXT&nbsp;AFTER&nbsp;THE</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DETECTOR&nbsp;JUST&nbsp;PASSING.</i><br>
#<i>&nbsp;&nbsp;THE&nbsp;USER&nbsp;CAN&nbsp;TERMINATE&nbsp;A&nbsp;HISTORY&nbsp;BY&nbsp;SETTING&nbsp;IDISC&gt;0.&nbsp;THE&nbsp;USER</i><br>
#<i>&nbsp;&nbsp;CAN&nbsp;TRANSPORT&nbsp;THE&nbsp;LAST&nbsp;PARTICLE&nbsp;&nbsp;BY&nbsp;SETTING&nbsp;IDISC&lt;0.&nbsp;HERE&nbsp;WE</i><br>
#<i>&nbsp;&nbsp;TERMINATE&nbsp;ALL&nbsp;HISTORIES&nbsp;WHICH&nbsp;ENTER&nbsp;REGION&nbsp;6&nbsp;OR&nbsp;ARE&nbsp;GOING</i><br>
#<i>&nbsp;&nbsp;BACKWARDS&nbsp;IN&nbsp;REGION&nbsp;1&nbsp;OR&nbsp;HAVE&nbsp;PASSED&nbsp;THE&nbsp;LAST&nbsp;OBSERVATION&nbsp;LEVEL.</i><br>
#<i>*********************************************************************</i><br>
#<i>&nbsp;&nbsp;&nbsp;ELECTRON&nbsp;OR&nbsp;PHOTON&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POSITIVE&nbsp;Z-DIRECTION&nbsp;(W&gt;0)&nbsp;IS&nbsp;DOWNWARDS</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REGION&nbsp;1&nbsp;&nbsp;&nbsp;(VACUUM)</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V</i><br>
#<i>---------------------------&nbsp;&nbsp;&nbsp;&nbsp;STARTING&nbsp;PLANE&nbsp;AT&nbsp;-BOUND(1)&nbsp;=&nbsp;-ZALTIT</i><br>
#<i></i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REGION&nbsp;2&nbsp;&nbsp;&nbsp;(AIR&nbsp;WITH&nbsp;EXPONENTIALLY</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INCREASING&nbsp;DENSITY)</i><br>
#<i></i><br>
#<i>---------------------------&nbsp;&nbsp;&nbsp;&nbsp;BOUNDARY&nbsp;AT&nbsp;-BOUND(2)</i><br>
#<i></i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REGION&nbsp;3&nbsp;&nbsp;&nbsp;(AIR&nbsp;WITH&nbsp;EXPONENTIALLY</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INCREASING&nbsp;DENSITY)</i><br>
#<i></i><br>
#<i>---------------------------&nbsp;&nbsp;&nbsp;&nbsp;BOUNDARY&nbsp;AT&nbsp;&nbsp;-BOUND(3)</i><br>
#<i></i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REGION&nbsp;4&nbsp;&nbsp;&nbsp;(AIR&nbsp;WITH&nbsp;EXPONENTIALLY</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INCREASING&nbsp;DENSITY)</i><br>
#<i></i><br>
#<i>---------------------------&nbsp;&nbsp;&nbsp;&nbsp;BOUNDARY&nbsp;AT&nbsp;&nbsp;-BOUND(4)</i><br>
#<i></i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REGION&nbsp;5&nbsp;&nbsp;&nbsp;(AIR&nbsp;WITH&nbsp;EXPONENTIALLY</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INCREASING&nbsp;DENSITY)</i><br>
#<i></i><br>
#<i>-------------------------Z=0&nbsp;&nbsp;&nbsp;BOUNDARY&nbsp;AT&nbsp;-BOUND(5)&nbsp;&nbsp;&nbsp;(SEA&nbsp;LEVEL)</i><br>
#<i>////////////|/////////</i><br>
#<i>////////////|/////////&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REGION&nbsp;6&nbsp;&nbsp;&nbsp;(VACUUM)</i><br>
#<i>////////////V/////////&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(MAY&nbsp;CONTAIN&nbsp;DETECTOR)</i><br>
#<i>&nbsp;&nbsp;&nbsp;ELECTRON&nbsp;OR&nbsp;PHOTON</i><br>
#<i>------------------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BOUNDARY&nbsp;AT&nbsp;-BOUND(6)</i><br>
#<i></i><br>
#<i>*********************************************************************</i><br>
#<i>KEEP,EPCONT.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON/EPCONT/&nbsp;&nbsp;&nbsp;EDEP,RATIO,TSTEP,TUSTEP,USTEP,TVSTEP,VSTEP,IDISC,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IROLD,IRNEW,RHOFAC,&nbsp;EOLD,ENEW,EKE,ELKE,BETA2,GLE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TSCAT,IAUSFL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;EDEP,RATIO<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TSTEP,TUSTEP,USTEP,TVSTEP,VSTEP,RHOFAC,EOLD,ENEW,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EKE,ELKE,BETA2,GLE,TSCAT<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDISC,IROLD,IRNEW,IAUSFL(29)<br>
#<i>KEND.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON/GEOM/ZALTIT,BOUND(6),NEWOBS,OBSLVL(10)<br>
#<i>KEEP,OBSPAR.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/OBSPAR/&nbsp;&nbsp;OBSLEV,THCKOB,XOFF,YOFF,THETAP,PHIP,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THETPR,PHIPR,NOBSLV<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;OBSLEV(10),THCKOB(10),XOFF(10),YOFF(10),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THETAP,THETPR(2),PHIP,PHIPR(2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOBSLV<br>
#<i>KEEP,RUNPAR.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/RUNPAR/&nbsp;&nbsp;FIXHEI,THICK0,HILOECM,HILOELB,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STEPFC,NRRUN,NSHOW,PATAPE,MONIIN,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MONIOU,MDEBUG,NUCNUC,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CETAPE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHOWNO,ISHW,NOPART,NRECS,NBLKS,MAXPRT,NDEBDL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N1STTR,MDBASE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBDEL,DEBUG,FDECAY,FEGS,FIRSTI,FIXINC,FIXTAR,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIX1I,FMUADD,FNKG,FPRINT,FDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,GHEISH,GHESIG<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/RUNPAC/&nbsp;&nbsp;DSN,HOST,USER<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;FIXHEI,THICK0,HILOECM,HILOELB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STEPFC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NRRUN,NSHOW,PATAPE,MONIIN,MONIOU,MDEBUG,NUCNUC,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHOWNO,ISHW,NOPART,NRECS,NBLKS,MAXPRT,NDEBDL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N1STTR,MDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CETAPE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARACTER*79&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DSN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARACTER*20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOST,USER<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGICAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBDEL,DEBUG,FDECAY,FEGS,FIRSTI,FIXINC,FIXTAR,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIX1I,FMUADD,FNKG,FPRINT,FDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,GHEISH,GHESIG<br>
#<i>KEEP,STACKE.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON/STACKE/&nbsp;&nbsp;&nbsp;E,TIME,X,Y,Z,U,V,W,DNEAR,IQ,IGEN,IR,IOBS,LPCTE,NP<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;E(60),TIME(60)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X(60),Y(60),Z(60),U(60),V(60),W(60),DNEAR(60)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IQ(60),IGEN(60),IR(60),IOBS(60),LPCTE(60),NP<br>
#<i>KEND.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON/ACLOCK/NCLOCK,JCLOCK<br>
#<i>_____IF&nbsp;(NCLOCK.GT.JCLOCK)&nbsp;THEN</i><br>
#<i>______WRITE(MDEBUG,*&nbsp;)'&nbsp;HOWFAR:NP=',NP,'&nbsp;IR=',IR(NP),'&nbsp;IOBS=',IOBS(NP)</i><br>
#<i>______CALL&nbsp;AUSGB2</i><br>
#<i>_____END&nbsp;IF</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(IR(NP).GT.1&nbsp;.AND.&nbsp;IR(NP).LT.6)&nbsp;THEN<br>
#<i>&nbsp;***&nbsp;&nbsp;WE&nbsp;ARE&nbsp;IN&nbsp;THE&nbsp;ATMOSPHERE&nbsp;-&nbsp;CHECK&nbsp;THE&nbsp;GEOMETRY</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IRL=IR(NP)<br>
#<i>&nbsp;***&nbsp;&nbsp;GOING&nbsp;FORWARD&nbsp;-&nbsp;CONSIDER&nbsp;FIRST&nbsp;SINCE&nbsp;MOST&nbsp;FREQUENT</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOBS=IOBS(NP)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(W(NP).GT.0.0)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;***&nbsp;&nbsp;TVAL&nbsp;IS&nbsp;DISTANCE&nbsp;TO&nbsp;NEXT&nbsp;BOUNDARY&nbsp;OR</i><br>
#<i>&nbsp;&nbsp;***&nbsp;&nbsp;OBSERVATION&nbsp;LEVEL&nbsp;IN&nbsp;THIS&nbsp;DIRECTION</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TVAL=(-Z(NP)-MAX(BOUND(IRL),OBSLVL(NOBS)))/W(NP)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(TVAL.GT.USTEP)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;CAN&nbsp;TAKE&nbsp;CURRENTLY&nbsp;REQUESTED&nbsp;STEP</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DNEAR(NP)=TVAL*W(NP)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
#<i>&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;GO&nbsp;TO&nbsp;DETECTOR&nbsp;OR&nbsp;BOUNDARY,&nbsp;WHICH&nbsp;IS&nbsp;CLOSER</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USTEP=MAX(TVAL,0.0001)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(BOUND(IRL).GE.OBSLVL(NOBS))&nbsp;THEN<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;PARTICLE&nbsp;CROSSES&nbsp;BOUNDARY</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IRNEW=IRL+1<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;PARTICLE&nbsp;LEAVES&nbsp;AIR</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF((IRNEW.GE.6))IDISC=-1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(BOUND(IRL).LE.OBSLVL(NOBS))&nbsp;THEN<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;PARTICLE&nbsp;CROSSES&nbsp;DETECTOR</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NEWOBS=NOBS+1<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;MAKE&nbsp;A&nbsp;VERY&nbsp;SMALL&nbsp;STEP&nbsp;TO&nbsp;AVOID&nbsp;HANGUP&nbsp;OF&nbsp;PROGRAM</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF((USTEP.LE.0.0))USTEP&nbsp;=&nbsp;0.0001<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;TRANSPORT&nbsp;PARTICLE&nbsp;&nbsp;TO&nbsp;FINAL&nbsp;DETECTOR&nbsp;LEVEL&nbsp;AND&nbsp;DISCARD&nbsp;IT</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF((NEWOBS.GT.NOBSLV))IDISC=-1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
#<i>&nbsp;&nbsp;***&nbsp;&nbsp;END&nbsp;OF&nbsp;W(NP)&gt;0&nbsp;CASE</i><br>
#<i>&nbsp;&nbsp;***&nbsp;&nbsp;GOING&nbsp;UPWARD&nbsp;IN&nbsp;ATMOSPHERE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;IF(W(NP).LT.0.0)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;***&nbsp;&nbsp;NO&nbsp;DETECTOR&nbsp;ABOVE&nbsp;PARTICLE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(NOBS.LE.1)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;DISTANCE&nbsp;TO&nbsp;BOUNDARY&nbsp;ABOVE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TVAL=(-Z(NP)-BOUND(IRL-1))/W(NP)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(TVAL.GT.USTEP)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;CAN&nbsp;TAKE&nbsp;CURRENTLY&nbsp;REQUESTED&nbsp;STEP</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DNEAR(NP)=MIN(Z(NP)+BOUND(IRL-1),-(Z(NP)+BOUND(IRL)))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;CROSS&nbsp;BOUNDARY&nbsp;ABOVE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USTEP=MAX(TVAL,0.0001)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IRNEW=IRL-1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
#<i>&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;BOUNDARY&nbsp;AND&nbsp;DETECTOR&nbsp;ABOVE&nbsp;PARTICLE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TVAL=(-Z(NP)-MIN(BOUND(IRL-1),OBSLVL(NOBS-1)))/W(NP)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(TVAL.GT.USTEP)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;CAN&nbsp;TAKE&nbsp;CURRENTLY&nbsp;REQUESTED&nbsp;STEP</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;DNEAR&nbsp;IS&nbsp;CLOSEST&nbsp;DISTANCE&nbsp;TO&nbsp;DETECTOR&nbsp;OR</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;BOUNDARY&nbsp;ABOVE&nbsp;OR&nbsp;BELOW&nbsp;PARTICLE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DNEAR(NP)=MIN(Z(NP)+MIN(BOUND(IRL-1),OBSLVL(NOBS-1)),&nbsp;-Z(NP)&nbsp;+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MAX(BOUND(IRL),OBSLVL(NOBS)))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;TAKE&nbsp;ONLY&nbsp;STEP&nbsp;UP&nbsp;TO&nbsp;BOUNDARY&nbsp;OR&nbsp;DETECTOR</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USTEP=MAX(TVAL,0.0001)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(BOUND(IRL-1).LE.OBSLVL(NOBS-1))&nbsp;THEN<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;PARTICLE&nbsp;CROSSES&nbsp;&nbsp;BOUNDARY&nbsp;ABOVE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IRNEW=IRL-1<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;PARTICLE&nbsp;LEAVES&nbsp;ATMOSPHERE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF((IRNEW.LE.1))IDISC=1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;((BOUND(IRL-1).GE.OBSLVL(NOBS-1)))&nbsp;THEN<br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;PARTICLE&nbsp;CROSSES&nbsp;DETECTOR&nbsp;ABOVE;&nbsp;IT&nbsp;IS&nbsp;NOT</i><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;***&nbsp;&nbsp;PRINTED,&nbsp;BECAUSE&nbsp;IT&nbsp;MUST&nbsp;HIT&nbsp;DETECTOR&nbsp;DOWNWARDS</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NEWOBS=NOBS-1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IOBS(NP)=NEWOBS<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
#<i>&nbsp;&nbsp;***&nbsp;&nbsp;END&nbsp;W(NP)&lt;0&nbsp;CASE</i><br>
#<i>&nbsp;&nbsp;***&nbsp;&nbsp;PARTICLE&nbsp;IS&nbsp;MOVING&nbsp;HORIZONTALLY,&nbsp;CANNOT&nbsp;HIT&nbsp;BOUNDARY</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;IF(W(NP).EQ.0.0)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
#<i>&nbsp;***&nbsp;&nbsp;END&nbsp;OF&nbsp;ATMOSPHERE&nbsp;REGION&nbsp;CASE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;IF(IR(NP).EQ.6)&nbsp;THEN<br>
#<i>&nbsp;***&nbsp;&nbsp;TERMINATE&nbsp;THIS&nbsp;HISTORY,&nbsp;IT&nbsp;IS&nbsp;PAST&nbsp;THE&nbsp;ATMOSPHERE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDISC=1<br>
#<i>&nbsp;***&nbsp;&nbsp;WE&nbsp;ARE&nbsp;IN&nbsp;THE&nbsp;REGION&nbsp;WITH&nbsp;SOURCE&nbsp;ABOVE&nbsp;AIR</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;IF(IR(NP).EQ.1)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(W(NP).GT.0.0)&nbsp;THEN<br>
#<i>&nbsp;&nbsp;***&nbsp;&nbsp;IT&nbsp;MUST&nbsp;BE&nbsp;A&nbsp;SOURCE&nbsp;PARTICLE&nbsp;ON&nbsp;BOUNDARY&nbsp;1</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USTEP=0.0001<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IRNEW=2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
#<i>&nbsp;&nbsp;***&nbsp;&nbsp;IT&nbsp;IS&nbsp;A&nbsp;REFLECTED&nbsp;PARTICLE,&nbsp;DISCARD&nbsp;IT</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDISC=1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
#<i>&nbsp;***&nbsp;&nbsp;END&nbsp;REGION&nbsp;1&nbsp;CASE</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<br>
<p><hr><p></body></html>
