<html><head><title>bhabha.f</title></head><body><center>
<h2>CORSIKA Code version 5.20 mod / bhabha.f</h2></center>
<i>Fortran project <a href="PROJECT_OVERVIEW.html">CORSIKA Code version 5.20 mod</a>,
     source module bhabha.f</i>.<p>
<i>Source module last modified on Fri, 2 Jun 2000, 10:48;</i><br>
<i>HTML image of Fortran source automatically generated by <a href="http://www.e13.physik.tu-muenchen.de/Wuttke/f2h.html">
 for2html</a> on Fri, 2 Jun 2000, 12:11.</i>
<p><hr><p><code>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name="bhabha" href="PROJECT_OVERVIEW.html#bhabha">SUBROUTINE&nbsp;BHABHA</a><br>
#<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VERSION&nbsp;4.00&nbsp;&nbsp;--&nbsp;&nbsp;26&nbsp;JAN&nbsp;1986/1900</i><br>
#<i>******************************************************************</i><br>
#<i>&nbsp;&nbsp;&nbsp;DISCRETE&nbsp;BHABHA&nbsp;SCATTERING&nbsp;(A&nbsp;CALL&nbsp;TO&nbsp;THIS&nbsp;ROUTINE)&nbsp;HAS&nbsp;BEEN</i><br>
#<i>&nbsp;&nbsp;&nbsp;ARBITRARILY&nbsp;DEFINED&nbsp;AND&nbsp;CALCULATED&nbsp;TO&nbsp;MEAN&nbsp;BHABHA&nbsp;SCATTERINGS</i><br>
#<i>&nbsp;&nbsp;&nbsp;WHICH&nbsp;IMPART&nbsp;TO&nbsp;THE&nbsp;SECONDARY&nbsp;ELECTRON&nbsp;SUFFICIENT&nbsp;ENERGY&nbsp;THAT</i><br>
#<i>&nbsp;&nbsp;&nbsp;IT&nbsp;BE&nbsp;TRANSPORTED&nbsp;DISCRETELY,&nbsp;I.E.&nbsp;E=AE&nbsp;OR&nbsp;T=TE.&nbsp;&nbsp;IT&nbsp;IS&nbsp;NOT</i><br>
#<i>&nbsp;&nbsp;&nbsp;GUARANTEED&nbsp;THAT&nbsp;THE&nbsp;FINAL&nbsp;POSITRON&nbsp;WILL&nbsp;HAVE&nbsp;THIS&nbsp;MUCH&nbsp;ENERGY</i><br>
#<i>&nbsp;&nbsp;&nbsp;HOWEVER.&nbsp;&nbsp;THE&nbsp;EXACT&nbsp;BHABHA&nbsp;DIFFERENTIAL&nbsp;CROSS&nbsp;SECTION&nbsp;IS&nbsp;USED.</i><br>
#<i>******************************************************************</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;PEIP,PEKSE2,PESE1,PESE2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;PEKIN,PEKINI,H1,DCOSTH<br>
#<i>KEEP,RANDPA.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/RANDPA/&nbsp;&nbsp;FAC,U1,U2,RD,NSEQ,ISEED,KNOR<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;FAC,U1,U2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RD(3000)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ISEED(103,10),NSEQ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGICAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KNOR<br>
#<i>KEEP,RUNPAR.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/RUNPAR/&nbsp;&nbsp;FIXHEI,THICK0,HILOECM,HILOELB,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STEPFC,NRRUN,NSHOW,PATAPE,MONIIN,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MONIOU,MDEBUG,NUCNUC,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CETAPE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHOWNO,ISHW,NOPART,NRECS,NBLKS,MAXPRT,NDEBDL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N1STTR,MDBASE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBDEL,DEBUG,FDECAY,FEGS,FIRSTI,FIXINC,FIXTAR,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIX1I,FMUADD,FNKG,FPRINT,FDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,GHEISH,GHESIG<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON&nbsp;/RUNPAC/&nbsp;&nbsp;DSN,HOST,USER<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;FIXHEI,THICK0,HILOECM,HILOELB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STEPFC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NRRUN,NSHOW,PATAPE,MONIIN,MONIOU,MDEBUG,NUCNUC,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHOWNO,ISHW,NOPART,NRECS,NBLKS,MAXPRT,NDEBDL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N1STTR,MDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CETAPE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARACTER*79&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DSN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARACTER*20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOST,USER<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGICAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBDEL,DEBUG,FDECAY,FEGS,FIRSTI,FIXINC,FIXTAR,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIX1I,FMUADD,FNKG,FPRINT,FDBASE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,GHEISH,GHESIG<br>
#<i>KEEP,STACKE.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON/STACKE/&nbsp;&nbsp;&nbsp;E,TIME,X,Y,Z,U,V,W,DNEAR,IQ,IGEN,IR,IOBS,LPCTE,NP<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;E(60),TIME(60)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X(60),Y(60),Z(60),U(60),V(60),W(60),DNEAR(60)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IQ(60),IGEN(60),IR(60),IOBS(60),LPCTE(60),NP<br>
#<i>KEND.</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON/THRESH/RMT2,RMSQ,ESCD2,AP,API,AE,UP,UE,TE,THMOLL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON/UPHIOT/THETA,SINTHE,COSTHE,SINPHI,&nbsp;COSPHI,PI,TWOPI,PI5D2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE&nbsp;PRECISION&nbsp;PZERO,PRM,PRMT2,RMI,VC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON/USEFUL/PZERO,PRM,PRMT2,RMI,VC,RM,MEDIUM,MEDOLD,IBLOBE,ICALL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMON/ACLOCK/NCLOCK,JCLOCK<br>
#<i>_____IF&nbsp;(NCLOCK.GT.JCLOCK)&nbsp;THEN</i><br>
#<i>______WRITE(MDEBUG,*&nbsp;)'&nbsp;BHABHA:NP=',NP,'&nbsp;IR=',IR(NP),'&nbsp;IOBS=',IOBS(NP)</i><br>
#<i>______CALL&nbsp;AUSGB2</i><br>
#<i>_____END&nbsp;IF</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PEIP=E(NP)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EIP=PEIP<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PEKIN=PEIP-PRM<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EKIN=PEKIN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PEKINI=1./PEKIN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EKINI=PEKINI<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T0=EKIN*RMI<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E0=T0+1.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YY=1./(T0+2.)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E02=E0*E0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BETAI2=E02/(E02-1.)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EP0=TE*EKINI<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EP0C=1.-EP0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y2=YY*YY<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YP=1.-2.*YY<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YP2=YP*YP<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B4=YP2*YP<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B3=B4+YP2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B2=YP*(3.+Y2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B1=2.-Y2<br>
341&nbsp;&nbsp;&nbsp;CONTINUE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;<a href="rmmar.html#rmmar">RMMAR</a>(RD,2,2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RNNO03=RD(1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RNNO04=RD(2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BR=EP0/(1.-EP0C*RNNO03)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REJF2=EP0C*(BETAI2-BR*(B1-BR*(B2-BR*(B3-BR*B4))))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF((RNNO04.LE.REJF2))GO&nbsp;TO342<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GO&nbsp;TO&nbsp;341<br>
342&nbsp;&nbsp;&nbsp;CONTINUE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(BR.LT.0.5)&nbsp;THEN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IQ(NP+1)=3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IQ(NP)=3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IQ(NP+1)=2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BR=1.-BR<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BR=MAX(BR,0.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PEKSE2=BR*EKIN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PESE1=PEIP-PEKSE2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PESE2=PEKSE2+PRM<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E(NP)=PESE1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E(NP+1)=PESE2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H1=(PEIP+PRM)*PEKINI<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DCOSTH=MIN(H1*(PESE1-PRM)/(PESE1+PRM),1.D0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SINTHE=SQRT(1.D0-DCOSTH)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COSTHE=SQRT(DCOSTH)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;<a href="uphi.html#uphi">UPHI</a>(2,1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NP=NP+1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DCOSTH=MIN(H1*(PESE2-PRM)/(PESE2+PRM),1.D0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SINTHE=-SQRT(1.D0-DCOSTH)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COSTHE=SQRT(DCOSTH)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;<a href="uphi.html#uphi">UPHI</a>(3,2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<br>
<p><hr><p></body></html>
